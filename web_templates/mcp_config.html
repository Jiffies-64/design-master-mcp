{% extends "base.html" %}

{% block title %}MCP配置{% endblock %}

{% block content %}
<div class="header">
    <h1><i class="fas fa-file-alt"></i> Design Document MCP</h1>
    <div class="user-info">
        <span><i class="fas fa-user"></i> 当前用户: <strong>{{ username }}</strong></span>
        <a href="/logout" class="btn btn-warning"><i class="fas fa-sign-out-alt"></i> 退出登录</a>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <div>
            <h2><i class="fas fa-cog"></i> MCP配置</h2>
            <p>为您的IDE生成全局MCP配置</p>
        </div>
        <a href="/templates/market" class="btn"><i class="fas fa-arrow-left"></i> 返回模板市场</a>
    </div>
    
    <div class="card">
        <h3><i class="fas fa-info-circle"></i> 配置说明</h3>
        <p>此配置文件用于将您的IDE连接到Design Document MCP服务器。我们支持多种传输方式，请根据您的IDE选择合适的配置。</p>
    </div>
    
    <div class="form-group">
        <label for="serverUrl">服务器地址</label>
        <input type="text" id="serverUrl" value="{{ server_url }}" readonly>
    </div>
    
    <div class="form-group">
        <label for="apiKey">API密钥</label>
        <input type="text" id="apiKey" value="{{ api_key }}" readonly>
    </div>
    
    <div class="card">
        <h3><i class="fas fa-file-code"></i> MCP配置选项</h3>
        
        <!-- HTTP配置 -->
        <div class="form-group">
            <label>HTTP模式配置</label>
            <textarea id="httpConfig" readonly style="font-family: monospace; background: var(--light); height: 150px;">{
    "mcpServers": {
        "DesignMaster": {
            "url": "http://{{ mcp_host }}:{{ mcp_port }}/mcp",
            "headers": {
                "X-API-Key": "{{ api_key }}"
            }
        }
    }
}</textarea>
            <button class="btn btn-success" onclick="copyToClipboard('httpConfig')">
                <i class="fas fa-copy"></i> 复制HTTP配置
            </button>
        </div>
        
        <!-- SSE配置 -->
        <div class="form-group">
            <label>SSE模式配置</label>
            <textarea id="sseConfig" readonly style="font-family: monospace; background: var(--light); height: 150px;">{
    "mcpServers": {
        "DesignMaster": {
            "url": "http://{{ mcp_host }}:{{ mcp_port }}/sse",
            "headers": {
                "X-API-Key": "{{ api_key }}"
            }
        }
    }
}</textarea>
            <button class="btn btn-success" onclick="copyToClipboard('sseConfig')">
                <i class="fas fa-copy"></i> 复制SSE配置
            </button>
        </div>
    </div>
    
    <div class="card">
        <h3><i class="fas fa-question-circle"></i> 使用说明</h3>
        <ol>
            <li>选择适合您IDE的传输方式</li>
            <li>点击对应按钮复制配置到剪贴板</li>
            <li>在您的IDE中找到MCP配置选项</li>
            <li>将复制的JSON配置粘贴到相应位置</li>
            <li>保存配置并重启IDE</li>
            <li>现在您可以使用MCP工具生成设计文档了</li>
        </ol>
        <div class="alert alert-info">
            <h4><i class="fas fa-info-circle"></i> 传输方式说明</h4>
            <ul>
                <li><strong>STDIO</strong>: 通过标准输入输出与IDE通信，适合本地开发环境</li>
                <li><strong>HTTP</strong>: 通过HTTP协议与IDE通信，需要启动MCP服务</li>
                <li><strong>SSE</strong>: 通过Server-Sent Events与IDE通信，需要启动MCP服务</li>
            </ul>
        </div>
        
        <!-- 显示当前启动配置信息 -->
        <div class="alert alert-info">
            <h4><i class="fas fa-info-circle"></i> 当前启动配置</h4>
            <p>传输方式: <strong>{{ mcp_transport.upper() }}</strong></p>
            <p>主机地址: <strong>{{ mcp_host }}</strong></p>
            <p>端口: <strong>{{ mcp_port }}</strong></p>
            <p class="small">此配置由启动脚本生成，如需更改请修改启动参数</p>
        </div>
    </div>
</div>

<script>
    function copyToClipboard(elementId) {
        const textarea = document.getElementById(elementId);
        textarea.select();
        document.execCommand('copy');
        
        // Show feedback
        const button = event.target.tagName === 'I' ? event.target.parentElement : event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check"></i> 已复制到剪贴板!';
        setTimeout(() => {
            button.innerHTML = originalText;
        }, 2000);
    }
</script>
{% endblock %}